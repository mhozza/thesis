\chapter{Modely}

V sekcii \ref{sec:hmm-alignment} sme si zadefinovali HMM pre zarovnávanie sekvencií (obr. \ref{fig:simple-model}).
V našom riešení sme predstavili 2 modifikácie pôvodného HMM na zakomponovanie dodatočnej informácie, pričom sme využili klasifikátory. V oboch modeloch sú klasifikátory rovnaké, aj s rovnakým postupom trénovania. Líši sa len trénovanie samotného HMM a architektúra modelu.

\section{Model s klasifikátorom ako emisiou}

V tomto modeli sme nahradili emisné tabuľky stavov výstupom z klasifikátora.
Model teda bude vyzerať rovnako, aj pravdepodobnosti prechodov zostanú, ale emisná pravdepodobnosť sa nahradí výstupom z klasifikátora.

\begin{figure}[htp]
    \centering
    \includegraphics[width=.5\textwidth]{images/model_clf}
    \caption{Model s klasifikátorom ako emisiou}
\end{figure}


Problémom tohto modelu je, že výstup klasifikátora nezodpovedá emisným pravdepodobnostiam, ale akejsi istote klasifikátora o tom, že dve pozície majú byť zarovnané k sebe. Hodnoty z klasifikátora teda nesumujú do 1 a model nie je celkom korektný. V praxi sa však ukázalo, že to až tak nevadí, avšak o takomto modeli už nemôžme hovoriť ako o pravdepodobnostnom. Je len inšpirovaný HMM.1

V tomto modeli sme trénovali iba tranzície, emisie sme mali priamo z natrénovaného klasifikátora.

\section{Model s klasifikátorovou páskou}

Na to aby sme vyriešili problém s korektnosťou predošlého modelu, navrhli sme alternatívny model, ktorý navyše modeluje aj výstup z klasifikátora.
Nemodelujeme teda len dvojicu sekvencií, ale aj sekvenciu výstupov klasifikátora.
Pásku s výstupom z klasifikátora vieme považovať za akúsi pomôcku pre náš zarovnávač.

\begin{figure}[htp]
    \centering
    \includegraphics[width=.5\textwidth]{images/model_clf_paska}
    \caption{Model s klasifikátorovou páskou}
\end{figure}


Tento model je síce narozdiel od predošlého korektný pravdepodobnostný model, no má však jednu nevýhodu. Že okrem prípadov, keď klasifikátor vráti hodnotu blízku 0 -- teda tvrdí, že dané 2 pozície by nemali byť zarovnané k sebe (resp. daná pozícia by nemala byť zarovnaná k medzere), penalizuje aj prípady kedy klasifikátor vracia hodnoty blízke 1. Je to z dôvodu, že HMM sa trénuje pomocou frekvenčnej analýzy a pozícií, kde sa vyskytujú hodnoty blízke 1 je menej ako pozícií s hodnotami okolo 0.7.


\subsection{Trénovanie modelu} % (fold)
Pri tomto modeli stojí za zmienku aj spôsob trénovania.
Trénovali aj tranzície aj emisie, pričom základný princíp ostáva taký, ako sme si ho popísali v sekcii \ref{subsec:hmmtraining}.
Zaujímavé je trénovanie emisií klasifikátora.

Modelujeme 3 náhodné premenné -- $X$, $Y$ a $C$, pričom tieto náhodné premenné sú nezávislé. Teda platí $P(X \cap Y \cap C) = P(X)P(Y)P(C)$.
$P(X)$ a $P(Y)$ poznáme a potrebujeme ešte zistiť $P(C)$.
Môžme použiť nasledujúcu vetu:

\begin{vt}[Veta o úplnej pravdepodobnosti]
Nech $A_1\dots A_n$ tvoria rozklad univerza $\Omega$ a nech $B$ je udalosť, potom
$$P(B) = \sum_{i=1}^n P(B|A_i)P(A_i)$$
\end{vt}

% Takže nám stačí modelovať $P(C | X, Y) = P

\todo dokončiť počítanie P(C)

Klasifikátorovú pásku sme generovali pomocou oboch klasifikátorov, pričom v Match stave sme použili Match klasifikátor a v Insert stavoch InDel klasifikátor.
Výstupy z klasifikátora sme rozdelili do 10 košov rovnomerne na intervale <0, 1>.


% subsection Trénovanie modelu (end)
